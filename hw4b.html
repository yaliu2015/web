<html>
<head>
<link rel="stylesheet" type="text/css" href="css/hw4b.css">

<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script>
<script type="text/javascript">


var TicTacToe = {

	/* If the same symbol is present in these pairs, that player has won */

	winning_squares: [	
						['0', '1', '2'],
						['3', '4', '5'],
						['6', '7', '8'],
						['0', '3', '6'],
						['0', '4', '8'],
						['1', '4', '7'],
						['2', '5', '8'],
						['2', '4', '6']
	],

	init: function() {
		/* Draw the board */
                /* Start the container off as empty, then add squares to id */

		$("#container").html('');
                /* create the square for each row, and give them an id of 0 to 9 */

		for (i = 0; i < 9; i++) {
			$("#container").append("<div id=" + i + " onclick='TicTacToe.clicked(this.id)' onmouseover='TicTacToe.mouseovered(this.id)' onmouseout='TicTacToe.mouseouted(this.id)' class='square'></div>");

                /* Only put 3 squares on a row   */

			if (((i + 1) % 3) == 0) {
				$("#container").append("<div style='clear:both;'>");
			}
		}
              
               /*  X makes the first move   */
		this.player = 'X';
		
		//
		resizeText();
	},

	/* Called on each square click. Displays correct symbol for the clicked
	square, checks if the game is won or has ended in a tie */

	mouseovered: function(square_id){
		if (isGameOver == true){
			return;
		}
		
		if ("" == $('#' + square_id).html()) {
			var localColor = 'blue';
			var newplayer = 'x'
			if (this.player == 'X'){
				newplayer = 'x';
				localColor = 'blue';
			}else if (this.player == 'O'){
				newplayer = 'o';
				localColor = 'red';
			}
			$('#' + square_id).text(newplayer);
			$('#' + square_id).css('color',localColor);
		}
	},
	
	mouseouted: function(square_id){
		if (isGameOver == true){
			return;
		}
		
		var currentText = $('#' + square_id).html();
		if ('x' == currentText || 'o' == currentText) {
			$('#' + square_id).text('');
		}
	},
	
	clicked: function(square_id) {
		if (isGameOver == true){
			return;
		}
                /* See if this square is empty, if so put an X or O in it  */
		var currentVal = $('#' + square_id).html();
		if ('o' == currentVal || 'x' == currentVal) {
			$('#' + square_id).text(this.player);
			if (this.player == 'X'){
				$('#' + square_id).css('color','blue');
			}
			else{
				$('#' + square_id).css('color','red');
			}
			

                        /*  Call is_game_won function to see if this move wins the game   */

			game_is_won = this.is_game_won(square_id);
                       
                        /* if the game_is_won, declare victory for this.player  */

			if (game_is_won)
				{this.end_game(this.player);
				return;}
				
			else

                         /*  Check for a tie game  */
				game_is_tied = this.is_game_tied();
				if (game_is_tied) {
					this.end_game();
					return;
				}
                   
                        /* if not won or tied, switch to the other player's move  */

				this.player = (this.player == 'X')? 'O': 'X';
		}
			
	},

	/* Did clicking on this square result in a victory? */

	is_game_won: function(square_id) {
		for (i in this.winning_squares) {
			if (jQuery.inArray(square_id, this.winning_squares[i]) != -1) {
				var squares = this.winning_squares[i];
				var pattern = '';
				for (j in squares) {
					console.log(squares[j]);
					pattern += $('#' + squares[j]).html();
				}
				symbol = this.player;
				if (symbol + symbol + symbol == pattern) {
					for (j in squares){
						$('#' + squares[j]).css("-webkit-animation", "myfirst 0.5s linear 0.2s infinite alternate");
					}
					
					return true;
				}
			}
		}
		return false;
	},



	/* All squares filled but no winner? */

	is_game_tied: function() {
		for (i = 0; i < 9; i++) {
			if ('' == $('#' + i).html())
				return false;
		}
		return true;
	},

	/* Display message and restart if requested */
	end_game: function(winner) {
		if (winner)
			msg = winner + ' Won.';
		else
			msg = 'Game Tie.';
		//restart_game = confirm(msg);
		//if (restart_game)
			//this.init();
		$("p").html(msg + ' Click Play to Start Game.');
		$("#stopBtn").css("background-color", "gray");
		$("#playBtn").css("background-color", "gray");
		isGameOver = true;
	}
};


/* Start TicTacToe whne the document is loaded */

$(document).ready(function(){
	TicTacToe.init();
	
	$("#playBtn").click(function(){
        //$("p").hide();
		$("p").html('Now Game');
		$(this).css("background-color", "#00FF7F");
		$("#stopBtn").css("background-color", "gray");
		isGameOver = false;
		TicTacToe.init();

    });
	
	$("#stopBtn").click(function(){
		
		$("p").html('Game Over. Click Start to Play.');
		$(this).css("background-color", "00FF7F");
		$("#playBtn").css("background-color", "gray");
		isGameOver = true;
		$(".square").css("-webkit-animation", "");
		
    });
});

var resizeText = function () {
        // Standard height, for which the body font size is correct
        var preferredFontSize = 46; // %
		var preferredContainerWidth = 390;
		var preferredSquareWidth = 120;
        var preferredSize = 1024 * 768;

        var currentSize = $(window).width() * $(window).height();
        var scalePercentage = Math.sqrt(currentSize) / Math.sqrt(preferredSize);
		if (scalePercentage < 1){
			var containerNewD = preferredContainerWidth * scalePercentage;
			$("#container").css("height", containerNewD + 'px');
			$("#container").css("width", containerNewD + 'px');
			var newFontSize = preferredFontSize * scalePercentage;
			$(".square").css("font-size", newFontSize + 'px');
			var newdim = preferredSquareWidth * scalePercentage;
			$(".square").css("height", newdim + 'px');
			$(".square").css("width", newdim + 'px');
			$(".square").css("line-height", newdim + 'px');
		}
		else{
			$("#container").css("height", preferredContainerWidth + 'px');
			$("#container").css("width", preferredContainerWidth + 'px');
			$(".square").css("font-size", preferredFontSize + 'px');
			$(".square").css("height", preferredSquareWidth + 'px');
			$(".square").css("width", preferredSquareWidth + 'px');
			$(".square").css("line-height", preferredSquareWidth + 'px');
		}
    };

$(window).bind('resize', function() {
	resizeText();
}).trigger('resize');


</script>
</head>

<body id="background">
	<div id="centerposition">
    	<div id="text-div">
        	<h2>TIC TAC TOE</h2>
        </div>
        <div id="text-div">
        <button id="playBtn">Play</button>
        <button id="stopBtn">Stop</button>
        </div>
        <div id="text-div">
        	<p id='addstring'>Click Play to Start</p>
        </div>
        <br>
		<div id="container"></div>
    </div>
</body>
</html>
